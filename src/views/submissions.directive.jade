loader(ng-hide="vm.loaded")

include parts/header

.subheader(ng-if="vm.status == 'scheduled'")
  img.icon.biggest(src="/images/clock.svg")

  p Submissions for the {{ vm.stepName }} Phase coming in

  countdown.block(end="{{ vm.startsAt }}")

.subheader(ng-if="vm.status == 'closed'")
  p Congratulations! These are your {{ vm.stepName }} winners.

  hr.small

  ul.winners
    li(ng-repeat="rank in vm.ranks" ng-if="rank.id")
      .rank <strong>{{rank.label.slice(0, -5)}}</strong><br /> place

      avatar(avatar-url="{{rank.avatarUrl}}")

      a.name(href="#") {{rank.handle}}

.subheader(ng-if="vm.status == 'open'")
  p Give feedback and select the top {{ vm.ranks.length }} designs. You have 

    countdown(end="{{vm.endsAt}}")
    | 
    | to give feedback.

  ul.top-selection
    li(ng-repeat="rank in vm.ranks track by $index")
      .shell(
        ng-class="{ 'has-avatar': rank.avatarUrl }"
        ondragenter="return false"
        ondragover="return false"
        on-drop="vm.drop.handle(event, rank.value)"
      )
        div(ng-if="rank.id" data-id="{{ rank.id }}" draggable)
          avatar(avatar-url="{{ rank.avatarUrl }}")

          .rank {{ rank.value }}

        .rank(ng-if="!rank.avatarUrl") {{ rank.value }}

    li(ng-show="vm.allFilled")
      button.action(ng-click="vm.confirmRanks()") Confirm your selections 

  p(ng-if="vm.rankUpdateError") {{ vm.rankUpdateError }}

ul.submissions
  li.submission.flex.elevated-bottom(ng-repeat="submission in vm.submissions track by $index" data-id="{{ submission.id }}" draggable)
    ul.user-details.flex.middle
      li
        avatar(avatar-url="{{ submission.submitter.avatar }}")

      li
        .name-time
          .name {{ submission.submitter.handle }}
          .count {{ submission.files.length }} Images

    ul.thumbnails.flex-grow
      li.thumbnail(ng-repeat="file in submission.files track by $index")
        a(ui-sref="file-detail({projectId: vm.projectId, stepId: vm.stepId, submissionId: submission.id, fileId: file.id})")
          img.img(ng-src="{{ file.url }}")

        .pop-over.elevated
          a.preview(ui-sref="file-detail({projectId: vm.projectId, stepId: vm.stepId, submissionId: submission.id, fileId: file.id})")
            img.previewImage(ng-src="{{ file.url }}")

          .icon.envelope

          a(href="{{ file.url }}", target="_blank")
            .clean.icon.download

    ul.actions.flex.middle.wrap
      li
        a(ui-sref="submission-detail({projectId: vm.projectId, stepId: vm.stepId, submissionId: submission.id})") view all

      li.comments(ng-if="vm.status != 'closed'")
        a(href="{{ submission.downloadUrl }}", target="_blank")
          .icon.download.small

      li.comments(ng-if="vm.status == 'closed' && submission.rank")
        a(href="{{ submission.downloadUrl }}", target="_blank")
          .icon.download.small

      li(ng-if="vm.status == 'open'")
        select(ng-model="submission.rank", ng-change="vm.handleRankSelect(submission)", ng-options="rank.value as rank.label for rank in vm.ranks")

      li(ng-if="vm.status == 'closed'") {{ vm.rankNames[$index] }}
